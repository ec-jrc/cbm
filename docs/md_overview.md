# Overview of the marker detection tool

**DOCUMENTATION IN PROGRESS**  

* GOALS  
* TARGET USERS  
* SKILLS NEEDED  

Identification of agricultural practices is a key step for the CbM and for the future area monitoring system (AMS). Several algorithms based on Copernicus Sentinel-1 and Sentinel-2 satellites have already been published in the literature. However, the application of these methods for operational monitoring requires tools that can efficiently analyse the large volume and streams of Sentinel data. In addition, for some practices proper methods has still to be defined and tuned on specific conditions of the territory assessed. This requires a platform where analysts can test their hypothesis, measures the uncertainty and consolidate the methods. In this context we developed a processing framework to detect markers, defined as an observation of a relevant bio-physical change of state, made on the Sentinel signal, on a given date. The markers can then be associated to agricultural activities on a parcel and used to confirm/reject the farmer declaration of a CAP scheme. This framework is built using a set of integrated Python modules and Object Oriented Programming (OOP) to facilitate its potential extension with new modules and algorithms designed to detect specific land practices.  
The JRC CbM is designed to reduce the data volume from Sentinel satellites and transform it into manageable information. Following this logic, the marker analysis is based on information extracted in the beckend from satellite bands for each homogeneous land management unit (declared parcel), moving from pixel to object analysis. The time series band statistics (mean, standard deviation, min, max, median, quantiles) and the histogram derived from the Scene Classification Layer (SCL) for Sentinel-2, and statistics of backscattering and 6-day coherence for Sentinel-1, are then further reduced to a set of detected markers.  
The processing architecture is built on four main modules: 1) import of band statistics, 2) data preprocessing, 3) identification of relevant changes in the signal time series (marker), 4) aggregation of markers from different sensors and association with land management practice, through the relevant bio-physical stages.  
The first module loads the object-based statistics generated by the backend and formats them according to the analytical requirements. Different sources can be set as data source, including direct database access, flat files (csv for statistics and shapefile/geojson for spatial units) and  RestFul Application Programming Interfaces (APIs).  
The second module offers a set of preprocessing tools to deal with incomplete and irregular time series (i.e., resampling, interpolation, smoothing, signal combination, cloudy observation removal , noise reduction). These signal processing blocks can be chained to allow the implementation of complex processing schemes before actual marker detection. Several processing chains can be allocated in parallel to simultaneously process  Sentinel-1 and Sentinel-2 data. In addition, the code architecture of this framework offers the possibility to improve the overall computational performance of each module by exploiting multi-threading to process observations from several spatial objects in parallel.
The third module analyses the temporal profiles of the relevant signals to detect markers resulting from land management practices. For example, aboveground biomass reduction associated with a mowing activity is expected to result in a drop in NDVI. Similarly, an increase in coherence is also expected. In this respect, several algorithms (detectors) able to identify, in a given time series, a specific feature corresponding to a marker have been implemented based on minima and maxima values of band statistics. For each marker, parameters such as duration, amplitude and period of occurrence are determined. These parameters can be used to exclude false positives and improve detection performance and fine tune the identification of relevant variations according to the specific environmental and climatic context and the practices monitored. Several graphical outputs help users to explore the results and build the most appropriate model.  
In the last module, the results from the marker detection run on all the specific bands and derived indices are combined to identify the relevant stages of the land management practices under assessment and obtain a more reliable detection. This approach is demonstrated for mowing detection using NDVI from Sentinel-2 and coherence from Sentinel-1. If an NDVI drop and a coherence increase are found on close time intervals, they can be associated leading to a more reliable activity detection. In a similar way, coherence can be used to compensate for data gaps in the NDVI time series.
The framework proposed demonstrates how to fully exploit the complementary nature of Sentinel-1 and Sentinel-2 observations. It is constantly under development and new features are frequently added.
